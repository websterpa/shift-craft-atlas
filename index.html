<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Craft (Atlas) | UK Staff Rostering SaaS</title>
    <meta name="description"
        content="Premium UK staff shift rostering system with built-in WTR compliance and real-time labor costing.">
    <link rel="stylesheet" href="src/css/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside>
            <div class="logo">Shift Craft <span
                    style="font-size: 0.85em; opacity: 0.85; font-weight: 400;">(Atlas)</span>
            </div>
            <nav style="flex-grow: 1;">
                <ul class="nav-links">
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="nav-dashboard">
                            <i data-lucide="layout-grid"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link active" id="nav-roster">
                            <i data-lucide="calendar"></i>
                            Shift Roster
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="nav-staff">
                            <i data-lucide="users"></i>
                            Staff Directory
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="#" class="nav-link" id="nav-payroll">
                            <i data-lucide="file-text"></i>
                            Payroll Export
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="nav-compliance">
                            <i data-lucide="shield-check"></i>
                            Compliance
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="nav-my-rosters">
                            <i data-lucide="archive"></i>
                            My Rosters
                        </a>
                    </li>
                </ul>
            </nav>
            <nav>
                <ul class="nav-links">
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="nav-help">
                            <i data-lucide="help-circle"></i>
                            Help & Features
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" id="nav-settings">
                            <i data-lucide="settings"></i>
                            Settings
                        </a>
                    </li>
                    <li class="nav-item"
                        style="margin-top: auto; border-top: 1px solid var(--glass-border); padding-top: 0.5rem;">
                        <a href="#" class="nav-link" id="nav-admin" style="color: var(--accent-blue);">
                            <i data-lucide="shield"></i>
                            Admin Dashboard
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content Wrapper -->
        <div class="content-wrapper" style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
            <!-- Global Top Bar (Consumer Branding) -->
            <div id="global-top-bar" class="global-header" style="display: none;">
                <div class="top-bar-branding">
                    <img src="" alt="Brand Logo" id="global-header-logo" class="global-logo" style="display: none;">
                    <div class="top-bar-text">
                        <span id="global-header-strapline" class="global-strapline"></span>
                    </div>
                </div>
                <div class="top-bar-actions">
                    <button class="btn btn-outline btn-icon" id="theme-toggle" title="Toggle Dark/Light Mode (T)">
                        <i data-lucide="sun"></i>
                    </button>
                </div>
            </div>

            <!-- Main Content Area -->
            <main style="flex: 1; overflow-y: auto; padding: 2.5rem;">
                <!-- Roster View -->
                <section id="view-roster" class="app-view">
                    <header>
                        <div class="header-title">
                            <h1>Weekly Roster</h1>
                            <p id="view-subtitle"
                                style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                                <span id="header-week-label">Jan 5 - Jan 11, 2026</span>
                                <span style="opacity: 0.3;">|</span>
                                <span id="roster-name-display" style="color: var(--accent-blue); font-weight: 600;">Main
                                    Roster</span>
                                <span style="opacity: 0.3;">|</span>
                                <span style="color:var(--accent-emerald)">Holiday Accrual (12.07%): £0.00</span>
                            </p>
                        </div>
                        <div class="header-actions" style="display: flex; gap: 1rem; align-items: center;">
                            <!-- View Toggle -->
                            <div class="view-toggle"
                                style="display: flex; background: var(--glass-bg); border-radius: 8px; border: 1px solid var(--glass-border); overflow: hidden;">
                                <button class="btn btn-toggle active" id="toggle-weekly-view" title="Weekly View">
                                    <i data-lucide="calendar" style="width:16px;height:16px;"></i> Weekly
                                </button>
                                <button class="btn btn-toggle" id="toggle-monthly-view" title="Monthly View">
                                    <i data-lucide="calendar-days" style="width:16px;height:16px;"></i> Monthly
                                </button>
                            </div>
                            <button class="btn btn-outline" id="ai-import-btn">
                                <i data-lucide="zap"></i> AI Roster Import
                            </button>
                            <button class="btn btn-outline" id="pattern-library-btn">
                                <i data-lucide="library"></i> Pattern Library
                            </button>
                            <button class="btn btn-outline" id="roster-wizard-btn"
                                style="border-color: var(--accent-purple); color: var(--accent-purple);">
                                <i data-lucide="wand-2"></i> Roster Wizard
                            </button>
                            <button class="btn btn-outline" id="smart-fill-btn"
                                style="border-color: var(--accent-blue);">
                                <i data-lucide="sparkles"></i> Smart Fill
                            </button>
                            <button class="btn btn-outline" id="export-roster-pdf-btn"
                                style="border-color: var(--accent-emerald); color: var(--accent-emerald);">
                                <i data-lucide="file-image"></i> Export Roster PDF
                            </button>
                            <div style="border-right: 1px solid var(--glass-border); height: 24px; margin: 0 0.5rem;">
                            </div>

                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-outline" id="clear-roster-btn" title="Clear Roster"
                                    style="border-color: var(--accent-rose); color: var(--accent-rose);">
                                    <i data-lucide="trash-2"></i>
                                </button>
                                <button class="btn btn-outline" id="save-snapshot-btn" title="Save Snapshot"
                                    style="border-color: var(--accent-blue); color: var(--accent-blue);">
                                    <i data-lucide="save"></i>
                                </button>
                            </div>

                            <div style="border-right: 1px solid var(--glass-border); height: 24px; margin: 0 0.5rem;">
                            </div>

                            <button class="btn btn-primary" id="add-shift-btn">
                                <i data-lucide="plus"></i> New Shift
                            </button>
                        </div>
                    </header>


                    <section class="stats-grid">
                        <div class="stat-card blue">
                            <div class="stat-label">Total Est. Cost</div>
                            <div class="stat-value" id="stat-cost">£0.00</div>
                        </div>
                        <div class="stat-card emerald">
                            <div class="stat-label">Hours Scheduled</div>
                            <div class="stat-value" id="stat-hours">0.0h</div>
                        </div>
                        <div class="stat-card amber">
                            <div class="stat-label">Staff Count</div>
                            <div class="stat-value" id="stat-staff">0</div>
                        </div>
                        <div class="stat-card rose">
                            <div class="stat-label">Compliance Alerts</div>
                            <div class="stat-value" id="stat-alerts">0</div>
                        </div>
                    </section>

                    <section class="roster-builder">
                        <div class="roster-header">
                            <div class="roster-controls" style="display: flex; gap: 0.5rem; align-items: center;">
                                <button class="btn btn-outline btn-icon" id="prev-week"><i data-lucide="chevron-left"
                                        style="width:16px;height:16px;"></i></button>
                                <span id="nav-week-label"
                                    style="font-weight: 600; min-width: 120px; text-align: center;">This Week</span>
                                <button class="btn btn-outline btn-icon" id="next-week"><i data-lucide="chevron-right"
                                        style="width:16px;height:16px;"></i></button>
                            </div>
                            <div class="roster-filters"
                                style="display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center;">
                                <select class="form-control" id="role-filter"
                                    style="width: auto; padding-top: 0.6rem; padding-bottom: 0.6rem;">
                                    <option value="all">All Roles</option>
                                </select>
                                <button class="btn btn-outline" id="autofill-btn"><i data-lucide="wand-2"
                                        style="width:16px;height:16px;"></i>
                                    Auto-Fill</button>
                                <button class="btn btn-outline" id="save-template-btn"
                                    title="Save current pattern as a template">
                                    <i data-lucide="save" style="width:16px;height:16px;"></i> Save Template
                                </button>
                                <button class="btn btn-outline" id="apply-template-btn"
                                    title="Apply a saved template to staff">
                                    <i data-lucide="copy" style="width:16px;height:16px;"></i> Apply Template
                                </button>
                            </div>
                        </div>
                        <div style="overflow-x: auto;" id="weekly-view-container">
                            <table class="roster-table">
                                <thead>
                                    <tr id="roster-thead-row">
                                        <th style="width: 200px;">EMPLOYEE</th>
                                    </tr>
                                </thead>
                                <tbody id="roster-tbody"></tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Inline Monthly Roster View (toggleable) -->
                    <section id="inline-monthly-view" class="roster-builder" style="display: none; padding: 1.5rem;">
                        <div class="monthly-view-header"
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <label style="font-weight: 600; color: var(--text-muted);">Staff Member:</label>
                                <select class="form-control" id="inline-monthly-staff-select"
                                    style="width: auto; min-width: 200px;">
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <button class="btn btn-outline btn-icon" id="inline-monthly-prev">
                                    <i data-lucide="chevron-left" style="width:16px;height:16px;"></i>
                                </button>
                                <span id="inline-monthly-label"
                                    style="font-weight: 600; min-width: 150px; text-align: center;">December 2025</span>
                                <button class="btn btn-outline btn-icon" id="inline-monthly-next">
                                    <i data-lucide="chevron-right" style="width:16px;height:16px;"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline" id="inline-monthly-export-pdf">
                                <i data-lucide="download" style="width:16px;height:16px;"></i> Export PDF
                            </button>
                        </div>

                        <!-- Monthly Stats Summary -->
                        <div class="stats-grid" style="margin-bottom: 1.5rem;">
                            <div class="stat-card blue" style="padding: 1rem;">
                                <div class="stat-label">Total Shifts</div>
                                <div class="stat-value" id="inline-monthly-shifts">0</div>
                            </div>
                            <div class="stat-card emerald" style="padding: 1rem;">
                                <div class="stat-label">Total Hours</div>
                                <div class="stat-value" id="inline-monthly-hours">0h</div>
                            </div>
                            <div class="stat-card amber" style="padding: 1rem;">
                                <div class="stat-label">Rest Days</div>
                                <div class="stat-value" id="inline-monthly-rest">0</div>
                            </div>
                            <div class="stat-card rose" style="padding: 1rem;">
                                <div class="stat-label">Night Shifts</div>
                                <div class="stat-value" id="inline-monthly-nights">0</div>
                            </div>
                        </div>

                        <!-- Calendar Grid Container -->
                        <div id="inline-monthly-calendar" class="monthly-calendar-grid">
                            <!-- Calendar populated dynamically -->
                        </div>
                    </section>
                </section>


                <!-- Dashboard View -->
                <section id="view-dashboard" class="app-view" style="display: none;">
                    <header>
                        <div class="header-title">
                            <h1>Business Intelligence</h1>
                            <p>Real-time labor costing & compliance health</p>
                        </div>
                    </header>

                    <div class="dashboard-metrics">
                        <div class="metric-card">
                            <div class="metric-header">
                                <span>MTD Labor Cost</span>
                                <i data-lucide="pound-sterling"></i>
                            </div>
                            <div class="metric-value" id="dash-mtd-cost">£0.00</div>
                            <div class="metric-trend trend-up">
                                <i data-lucide="trending-up" style="width:14px;height:14px;"></i>
                                <span>4.2% vs last month</span>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-header">
                                <span>Compliance Health</span>
                                <i data-lucide="shield-check"></i>
                            </div>
                            <div class="metric-value" id="dash-compliance-health">100%</div>
                            <div class="metric-trend trend-up">
                                <i data-lucide="check-circle" style="width:14px;height:14px;"></i>
                                <span>No major breaches</span>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-header">
                                <span>Scheduled Hours</span>
                                <i data-lucide="clock"></i>
                            </div>
                            <div class="metric-value" id="dash-scheduled-hours">0h</div>
                            <div class="metric-trend" id="dash-hours-variance">
                                <span>--</span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Weekly Labor Analysis</h3>
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <div class="legend-color" style="background: var(--primary);"></div>
                                    <span>Scheduled</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color"
                                        style="background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border);">
                                    </div>
                                    <span>Demand (Prev Week)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: var(--accent-emerald);"></div>
                                    <span>Labor Cost (£)</span>
                                </div>
                            </div>
                        </div>

                        <div class="svg-chart-container" id="dashboard-chart-container">
                            <!-- SVG injected here -->
                        </div>

                        <div id="chart-tooltip" class="chart-tooltip"></div>
                    </div>
                </section>

                <!-- Staff View -->
                <section id="view-staff" class="app-view" style="display: none;">
                    <header>
                        <div class="header-title">
                            <h1>Staff Directory</h1>
                            <p>Manage employee rates and WTR status</p>
                        </div>
                        <div style="display: flex; gap: 0.75rem;">
                            <button class="btn btn-outline" id="deduplicate-staff-btn"
                                style="border-color: var(--accent-amber); color: var(--accent-amber);">
                                <i data-lucide="user-minus"></i> Deduplicate Staff
                            </button>
                            <button class="btn btn-outline" id="open-monthly-roster-btn">
                                <i data-lucide="calendar-days"></i> Monthly View
                            </button>
                            <button class="btn btn-primary" id="add-staff-modal-btn">
                                <i data-lucide="user-plus"></i> Add Employee
                            </button>
                        </div>
                    </header>
                    <div class="bulk-actions-bar"
                        style="display: flex; gap: 1rem; align-items: center; background: var(--glass-bg); padding: 1rem; border-radius: 12px; border: 1px solid var(--glass-border); margin-bottom: 1.5rem;">
                        <div style="font-size: 0.9rem; color: var(--text-muted);"><span id="selected-count">0</span>
                            Selected</div>
                        <button class="btn btn-outline btn-sm" id="bulk-toggle-optout"><i data-lucide="shield"></i>
                            Toggle
                            WTD Opt-Out</button>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="number" step="0.5" id="bulk-hours-input" class="form-control"
                                style="width: 80px;" placeholder="Hrs">
                            <button class="btn btn-outline btn-sm" id="bulk-set-hours">Set Contracted Hrs</button>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="number" step="0.01" id="bulk-rate-input" class="form-control"
                                style="width: 80px;" placeholder="£ Rate">
                            <button class="btn btn-outline btn-sm" id="bulk-set-rate">Set Rate</button>
                        </div>
                    </div>

                    <div class="roster-builder" style="padding: 1.5rem;">
                        <table class="roster-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;"><input type="checkbox" id="select-all-staff"></th>
                                    <th>Staff #</th>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Rate (£)</th>
                                    <th>Contr. Hours</th>
                                    <th>48h Opt-Out</th>
                                    <th style="text-align: right;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="staff-list-tbody"></tbody>
                        </table>
                    </div>
                </section>



                <!-- Payroll Export View -->
                <section id="view-payroll" class="app-view" style="display: none;">
                    <header>
                        <div class="header-title">
                            <h1>Payroll Export</h1>
                            <p>Generate statutory export files</p>
                        </div>
                        <button class="btn btn-primary" id="final-export-btn">
                            <i data-lucide="download"></i> Download CSV
                        </button>
                    </header>
                    <div class="roster-builder" style="padding: 1.5rem;">
                        <table class="roster-table">
                            <thead>
                                <tr>
                                    <th>Staff Member</th>
                                    <th>Gross Pay</th>
                                    <th>Hol Accrual</th>
                                    <th>Total Due</th>
                                </tr>
                            </thead>
                            <tbody id="payroll-preview-tbody"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Compliance View -->
                <section id="view-compliance" class="app-view" style="display: none;">
                    <header>
                        <div class="branding-area" id="header-branding-compliance" style="display: none;">
                            <img src="" alt="Logo" class="brand-logo" style="display: none;">
                            <span class="brand-strapline"></span>
                        </div>
                        <div class="header-title"
                            style="display: flex; justify-content: space-between; align-items: flex-start; width: 100%;">
                            <div>
                                <h1>Compliance Center</h1>
                                <p>Monitoring UK Working Time Regulations</p>
                            </div>
                            <button class="btn btn-primary" id="generate-compliance-report">
                                <i data-lucide="file-text"></i> Generate Audit Report (PDF)
                            </button>
                        </div>
                    </header>
                    <div class="stats-grid">
                        <div class="stat-card rose">
                            <div class="stat-label">Reg 4 Risks</div>
                            <div class="stat-value" id="comp-48h-count">0</div>
                        </div>
                        <div class="stat-card amber">
                            <div class="stat-label">Reg 10 Breaches</div>
                            <div class="stat-value" id="comp-rest-count">0</div>
                        </div>
                    </div>
                    <div class="roster-builder" style="padding: 2rem; margin-top: 2rem;">
                        <h3>Risk Log</h3>
                        <ul id="compliance-log-list" style="list-style: none; margin-top: 1rem;">
                            <li style="color: var(--text-muted);">No compliance risks detected.</li>
                        </ul>
                    </div>
                </section>

                <!-- My Rosters View -->
                <section id="view-my-rosters" class="app-view" style="display: none;">
                    <header>
                        <div class="branding-area" id="header-branding-my-rosters" style="display: none;">
                            <img src="" alt="Logo" class="brand-logo" style="display: none;">
                            <span class="brand-strapline"></span>
                        </div>
                        <div class="header-title">
                            <h1>My Rosters</h1>
                            <p id="my-rosters-subtitle" class="text-muted">Manage your saved snapshots and archived
                                rosters.
                            </p>
                        </div>
                        <div class="header-actions">
                            <span id="saved-rosters-count" class="badge">0 Saved</span>
                        </div>
                    </header>

                    <div id="my-rosters-grid" class="roster-grid-container" style="
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                    gap: 1.5rem;
                    margin-top: 2rem;
                ">
                        <!-- Roster cards will be injected here -->
                        <div class="empty-state"
                            style="grid-column: 1 / -1; text-align: center; padding: 4rem; background: var(--glass-bg); border-radius: 16px; border: 1px dashed var(--glass-border);">
                            <i data-lucide="archive"
                                style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.2;"></i>
                            <h3>No Saved Rosters</h3>
                            <p class="text-muted">Your saved snapshots will appear here.</p>
                        </div>
                    </div>
                </section>

                <!-- Settings View -->
                <section id="view-settings" class="app-view" style="display: none;">
                    <header>
                        <div class="branding-area" id="header-branding-settings" style="display: none;">
                            <img src="" alt="Logo" class="brand-logo" style="display: none;">
                            <span class="brand-strapline"></span>
                        </div>
                        <div class="header-title">
                            <h1>System Settings</h1>
                            <p>Global configuration and data management</p>
                        </div>
                    </header>
                    <div class="roster-builder" style="padding: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div class="form-group">
                                <label>WTR Rest Period (Hours)</label>
                                <input type="number" class="form-control" id="setting-rest" value="11"
                                    style="max-width: 200px;">
                                <small style="color: var(--text-muted);">Statutory minimum is 11 hours (Reg 10 WTR
                                    1998).</small>
                            </div>
                            <div class="form-group">
                                <label>Operating Patterns</label>
                                <label
                                    style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;font-size:0.9rem;cursor:pointer;">
                                    <input type="checkbox" id="setting-enable-nights" checked> Enable Night Shift
                                    working
                                </label>
                                <label
                                    style="display:flex;align-items:center;gap:0.5rem;font-size:0.9rem;cursor:pointer;">
                                    <input type="checkbox" id="setting-enable-weekends" checked> Enable Weekend working
                                </label>
                                <div style="margin-top: 1rem;">
                                    <label style="font-size: 0.8rem; color: var(--text-muted);">Region for Bank
                                        Holidays</label>
                                    <select class="form-control" id="setting-holiday-region"
                                        style="margin-top: 0.25rem;">
                                        <option value="england-and-wales">England & Wales</option>
                                        <option value="scotland">Scotland</option>
                                        <option value="northern-ireland">Northern Ireland</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <hr style="border: 0; border-top: 1px solid var(--glass-border); margin: 2rem 0;">

                        <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="users" style="width: 20px; color: var(--accent-emerald);"></i>
                            Staffing Requirements
                        </h3>
                        <p style="color: var(--text-muted); margin-bottom: 1.5rem; font-size: 0.9rem;">
                            Define the minimum number of staff required for each shift type per day. Coverage indicators
                            will appear in the roster header.
                        </p>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span
                                        style="width: 24px; height: 24px; background: var(--shift-early); border-radius: 4px;"></span>
                                    Early (E)
                                </label>
                                <input type="number" class="form-control" id="req-early" min="0" max="20" value="2"
                                    style="max-width: 80px;">
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span
                                        style="width: 24px; height: 24px; background: var(--shift-late); border-radius: 4px;"></span>
                                    Late (L)
                                </label>
                                <input type="number" class="form-control" id="req-late" min="0" max="20" value="2"
                                    style="max-width: 80px;">
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span
                                        style="width: 24px; height: 24px; background: var(--shift-night); border-radius: 4px;"></span>
                                    Night (N)
                                </label>
                                <input type="number" class="form-control" id="req-night" min="0" max="20" value="1"
                                    style="max-width: 80px;">
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span
                                        style="width: 24px; height: 24px; background: var(--shift-day); border-radius: 4px;"></span>
                                    Day 12h (D)
                                </label>
                                <input type="number" class="form-control" id="req-day12" min="0" max="20" value="1"
                                    style="max-width: 80px;">
                            </div>
                        </div>

                        <button class="btn btn-primary" id="save-requirements-btn">
                            <i data-lucide="save"></i> Save Requirements
                        </button>

                        <hr style="border: 0; border-top: 1px solid var(--glass-border); margin: 2rem 0;">

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                            <div>
                                <h4 style="margin-bottom: 1rem; color: var(--accent-blue);">8-Hour Shift Starts</h4>
                                <div class="form-group">
                                    <label>Early Start</label>
                                    <input type="time" class="form-control" id="standard-8-early" value="06:00">
                                </div>
                                <div class="form-group">
                                    <label>Late Start</label>
                                    <input type="time" class="form-control" id="standard-8-late" value="14:00">
                                </div>
                                <div class="form-group">
                                    <label>Night Start</label>
                                    <input type="time" class="form-control" id="standard-8-night" value="22:00">
                                </div>
                            </div>

                            <div>
                                <h4 style="margin-bottom: 1rem; color: var(--accent-purple);">12-Hour Shift Starts</h4>
                                <div class="form-group">
                                    <label>Day Start</label>
                                    <input type="time" class="form-control" id="standard-12-day" value="07:00">
                                </div>
                                <div class="form-group">
                                    <label>Night Start</label>
                                    <input type="time" class="form-control" id="standard-12-night" value="19:00">
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 1rem;">
                            <button class="btn btn-primary" id="save-standards-btn">
                                <i data-lucide="save"></i> Save Standards
                            </button>
                        </div>
                        <hr style="border: 0; border-top: 1px solid var(--glass-border); margin: 2rem 0;">
                        <div class="form-group">
                            <label>Danger Zone</label>
                            <button class="btn btn-outline" id="clear-data-btn"
                                style="color: var(--accent-rose); border-color: var(--accent-rose);">
                                <i data-lucide="trash-2"></i> Factory Reset (Clear All Data)
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Admin Dashboard View -->
                <section id="view-admin" class="app-view" style="display: none;">
                    <header>
                        <div class="header-title">
                            <h1>Admin Dashboard</h1>
                            <p>System Configuration & Theme Customization</p>
                        </div>
                    </header>

                    <div class="stats-grid" style="margin-top: 1.5rem;">
                        <!-- Brand & Identity Card -->
                        <div class="stat-card" style="grid-column: span 2;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2.5rem;">
                                <!-- Identity Setup -->
                                <div>
                                    <h3 style="margin-bottom: 1.5rem; display:flex; align-items:center; gap:0.5rem;">
                                        <i data-lucide="award" style="width:20px; color:var(--accent-blue)"></i>
                                        Brand & Identity
                                    </h3>
                                    <div class="form-group">
                                        <label>Company Logo</label>
                                        <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                            <input type="file" id="branding-logo-input" accept="image/*"
                                                style="display: none;">
                                            <button class="btn btn-primary"
                                                onclick="document.getElementById('branding-logo-input').click()">
                                                <i data-lucide="upload"></i> Upload Logo
                                            </button>
                                            <button class="btn btn-outline" id="branding-logo-clear"
                                                style="color: var(--accent-rose); border-color: var(--accent-rose);">
                                                <i data-lucide="trash-2"></i> Clear
                                            </button>
                                        </div>
                                        <p
                                            style="font-size: 0.8rem; color: var(--text-muted); margin-top: 1rem; line-height: 1.4;">
                                            Your logo will appear in the global top bar across all views. We recommend a
                                            transparent PNG with high contrast.
                                        </p>
                                    </div>
                                    <div class="form-group" style="margin-top: 1.5rem;">
                                        <label>Header Strapline</label>
                                        <input type="text" id="branding-strapline" class="form-control"
                                            placeholder="e.g. Precision Staff Management" style="margin-top:0.5rem;">
                                    </div>
                                    <div class="form-group"
                                        style="margin-top: 1.5rem; display: flex; align-items: center; justify-content: space-between;">
                                        <label style="margin:0;">Brand & Strapline Color</label>
                                        <div style="display:flex; align-items:center; gap:0.5rem;">
                                            <input type="color" id="branding-color" value="#6366f1"
                                                style="border:none; background:none; width:40px; height:40px; cursor:pointer;">
                                            <code style="font-size:0.8rem; color:var(--text-muted);"
                                                id="val-branding-color">#6366f1</code>
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-top: 1.5rem;">
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center;">
                                            <label style="margin:0;">Header Spacing (Vertical)</label>
                                            <span id="val-branding-spacing"
                                                style="font-size: 0.8rem; color: var(--text-muted);">2.0rem</span>
                                        </div>
                                        <input type="range" id="branding-spacing" min="0" max="6" step="0.5" value="2"
                                            style="width: 100%; margin-top: 0.5rem; cursor: pointer;">
                                    </div>
                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label
                                            style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: normal;">
                                            <input type="checkbox" id="branding-hide-default-logo"
                                                style="width: 16px; height: 16px;">
                                            Hide default 'Shift Craft' logo in sidebar
                                        </label>
                                    </div>
                                    <div style="margin-top: 2rem;">
                                        <button class="btn btn-primary" id="save-branding-btn"
                                            style="width: 100%; justify-content: center; height: 3rem;">
                                            <i data-lucide="save"></i> Save Global Branding
                                        </button>
                                    </div>
                                </div>

                                <!-- Live Preview Area -->
                                <div
                                    style="background: var(--bg-dark); border-radius: 12px; border: 1px solid var(--glass-border); padding: 1.5rem; display: flex; flex-direction: column;">
                                    <h4
                                        style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1.5rem; letter-spacing: 1px;">
                                        Live Header Preview</h4>
                                    <div id="branding-preview-container"
                                        style="flex-grow: 1; border: 1px dashed var(--glass-border); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; position: relative;">
                                        <!-- Preview content injected by JS -->
                                        <div id="branding-logo-preview-large"
                                            style="max-width: 80%; max-height: 120px;">
                                            <i data-lucide="image" style="width: 48px; height: 48px; opacity: 0.2;"></i>
                                        </div>
                                        <div id="branding-strapline-preview-large"
                                            style="margin-top: 1.5rem; font-weight: 500; font-size: 1.1rem; color: var(--primary);">
                                        </div>
                                        <div
                                            style="position: absolute; bottom: 0.5rem; right: 0.5rem; font-size: 0.65rem; color: var(--text-muted); opacity: 0.5;">
                                            Preview (Scale 1:1)</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Theme Customization Section -->
                        <div class="stat-card" style="grid-column: span 2;">
                            <h3 style="margin-bottom: 2rem; display:flex; align-items:center; gap:0.5rem;">
                                <i data-lucide="palette" style="width:20px; color:var(--accent-blue)"></i>
                                Theme Customization
                            </h3>
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 2rem;">
                                <!-- Theme Presets -->
                                <div>
                                    <h4
                                        style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1.25rem; letter-spacing: 1px;">
                                        Theme Presets</h4>
                                    <div id="theme-presets-grid"
                                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1rem;">
                                        <!-- Presets will be injected by JS -->
                                    </div>
                                </div>

                                <!-- Environment Settings -->
                                <div>
                                    <h4
                                        style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1.25rem; letter-spacing: 1px;">
                                        Environment</h4>
                                    <div class="form-group"
                                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                                        <label style="margin:0; font-size: 0.9rem;">Backdrop</label>
                                        <input type="color" id="theme-bg-dark" value="#0f172a"
                                            style="border:none; background:none; width:34px; height:34px; cursor:pointer;">
                                    </div>
                                    <div class="form-group"
                                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                                        <label style="margin:0; font-size: 0.9rem;">Cards</label>
                                        <input type="color" id="theme-card-bg" value="#1e293b"
                                            style="border:none; background:none; width:34px; height:34px; cursor:pointer;">
                                    </div>
                                    <div
                                        style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                                        <button class="btn btn-sm btn-primary" id="save-theme-btn">Save Theme</button>
                                        <button class="btn btn-sm btn-outline" id="reset-theme-btn">Reset</button>
                                    </div>
                                </div>

                                <!-- Operational Colors -->
                                <div>
                                    <h4
                                        style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1.25rem; letter-spacing: 1px;">
                                        Shift Types</h4>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                        <div class="color-mini-chip"
                                            style="background: var(--shift-early); border-radius: 6px; padding: 0.25rem; display: flex; align-items: center; justify-content: space-between;">
                                            <span
                                                style="font-size: 0.7rem; font-weight: 700; padding-left: 0.25rem;">E</span>
                                            <input type="color" id="theme-shift-early" value="#fbbf24"
                                                style="border:none; background:none; width:24px; height:24px; cursor:pointer;">
                                        </div>
                                        <div class="color-mini-chip"
                                            style="background: var(--shift-late); border-radius: 6px; padding: 0.25rem; display: flex; align-items: center; justify-content: space-between;">
                                            <span
                                                style="font-size: 0.7rem; font-weight: 700; padding-left: 0.25rem;">L</span>
                                            <input type="color" id="theme-shift-late" value="#f97316"
                                                style="border:none; background:none; width:24px; height:24px; cursor:pointer;">
                                        </div>
                                        <div class="color-mini-chip"
                                            style="background: var(--shift-night); border-radius: 6px; padding: 0.25rem; display: flex; align-items: center; justify-content: space-between;">
                                            <span
                                                style="font-size: 0.7rem; font-weight: 700; padding-left: 0.25rem;">N</span>
                                            <input type="color" id="theme-shift-night" value="#8b5cf6"
                                                style="border:none; background:none; width:24px; height:24px; cursor:pointer;">
                                        </div>
                                        <div class="color-mini-chip"
                                            style="background: var(--shift-day); border-radius: 6px; padding: 0.25rem; display: flex; align-items: center; justify-content: space-between;">
                                            <span
                                                style="font-size: 0.7rem; font-weight: 700; padding-left: 0.25rem;">D</span>
                                            <input type="color" id="theme-shift-day" value="#10b981"
                                                style="border:none; background:none; width:24px; height:24px; cursor:pointer;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Health & Diagnostics -->
                        <div class="stat-card" style="grid-column: span 2;">
                            <h3 style="margin-bottom: 1.5rem; display:flex; align-items:center; gap:0.5rem;">
                                <i data-lucide="activity" style="width:20px; color:var(--accent-emerald)"></i>
                                System Health & Diagnostics
                            </h3>
                            <div style="display: flex; align-items: center; gap: 2rem;">
                                <div style="flex: 1;">
                                    <p
                                        style="color:var(--text-muted); margin-bottom: 1.5rem; font-size: 0.9rem; line-height: 1.5;">
                                        Perform a high-level integrity check on all roster data, staff records, and
                                        theme
                                        configurations to ensure system stability.
                                    </p>
                                    <button class="btn btn-outline" id="btn-run-diagnostics">
                                        <i data-lucide="play-circle"></i> Execute System Audit
                                    </button>
                                </div>
                                <div id="diagnostic-results"
                                    style="flex: 1; display:none; background: var(--bg-dark); padding: 1.25rem; border-radius: 12px; border: 1px solid var(--glass-border); min-height: 120px;">
                                    <h4
                                        style="font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 0.75rem; letter-spacing: 1px;">
                                        Audit Log</h4>
                                    <ul id="diagnostic-list"
                                        style="list-style: none; padding: 0; font-size: 0.85rem; max-height: 150px; overflow-y: auto;">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Help & Features View -->
                <section id="view-help" class="app-view" style="display: none;">
                    <header>
                        <div class="header-title">
                            <h1>User Instructions & Features Help</h1>
                            <p>Comprehensive guide to Shift Craft (Atlas) features and workflows.</p>
                        </div>
                    </header>
                    <div class="stats-grid" style="margin-top: 2rem;">
                        <div class="stat-card" style="align-items: flex-start;">
                            <h3
                                style="margin-bottom: 1rem; color: var(--accent-blue); display: flex; align-items: center; gap: 0.5rem;">
                                <i data-lucide="calendar"></i> Core Rostering
                            </h3>
                            <ul style="padding-left: 1.25rem; line-height: 1.6; color: var(--text-muted);">
                                <li style="margin-bottom:0.5rem"><strong>Weekly View:</strong> The main grid. Click
                                    empty cells
                                    to add shifts. Drag and drop to move shifts.</li>
                                <li style="margin-bottom:0.5rem"><strong>Monthly View:</strong> Click the calendar icon
                                    next to
                                    a staff member to see their full month.</li>
                                <li style="margin-bottom:0.5rem"><strong>Add Shift:</strong> Use the "New Shift" button
                                    or click
                                    on the grid. Select a "Preset" to auto-fill times (Early, Late, Night).</li>
                                <li style="margin-bottom:0.5rem"><strong>Shift Types:</strong>
                                    <div
                                        style="display:grid; grid-template-columns: 1fr 1fr; gap:0.5rem; margin-top:0.25rem; font-size:0.9em;">
                                        <span style="color: var(--shift-early)">● Early (E): 06:00-14:00</span>
                                        <span style="color: var(--shift-late)">● Late (L): 14:00-22:00</span>
                                        <span style="color: var(--shift-night)">● Night (N): 22:00-06:00</span>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="stat-card" style="align-items: flex-start;">
                            <h3
                                style="margin-bottom: 1rem; color: var(--accent-purple); display: flex; align-items: center; gap: 0.5rem;">
                                <i data-lucide="wand-2"></i> Automation Tools
                            </h3>
                            <ul style="padding-left: 1.25rem; line-height: 1.6; color: var(--text-muted);">
                                <li style="margin-bottom:0.5rem"><strong>Roster Wizard:</strong> Create a full roster
                                    from
                                    scratch. Define patterns (e.g. 4-on-4-off) and let the system assign shifts.</li>
                                <li style="margin-bottom:0.5rem"><strong>Smart Fill:</strong> Intelligently copies the
                                    previous
                                    week's pattern, respecting staff availability.</li>
                                <li style="margin-bottom:0.5rem"><strong>AI Import:</strong> Paste unstructured text
                                    (emails,
                                    notes) to automatically generate shifts.</li>
                                <li style="margin-bottom:0.5rem"><strong>Pattern Library:</strong> Save common shift
                                    sequences
                                    as templates.</li>
                            </ul>
                        </div>

                        <div class="stat-card" style="align-items: flex-start;">
                            <h3
                                style="margin-bottom: 1rem; color: var(--accent-emerald); display: flex; align-items: center; gap: 0.5rem;">
                                <i data-lucide="shield-check"></i> Compliance & Pay
                            </h3>
                            <ul style="padding-left: 1.25rem; line-height: 1.6; color: var(--text-muted);">
                                <li style="margin-bottom:0.5rem"><strong>WTR Compliance:</strong> Automatic checks for
                                    Working
                                    Time Regulations (11h daily rest, 24h/48h weekly rest).</li>
                                <li style="margin-bottom:0.5rem"><strong>Real-time Costing:</strong> Payroll estimates
                                    update
                                    instantly. Includes Holiday Accrual (12.07%).</li>
                                <li style="margin-bottom:0.5rem"><strong>Staff Management:</strong> Set hourly rates,
                                    roles, and
                                    48h opt-out status in the Staff Directory.</li>
                                <li style="margin-bottom:0.5rem"><strong>Exports:</strong> Download Rosters as PDF or
                                    export
                                    Payroll data as CSV.</li>
                            </ul>
                        </div>

                        <div class="stat-card" style="align-items: flex-start;">
                            <h3
                                style="margin-bottom: 1rem; color: var(--accent-amber); display: flex; align-items: center; gap: 0.5rem;">
                                <i data-lucide="settings"></i> System & Settings
                            </h3>
                            <ul style="padding-left: 1.25rem; line-height: 1.6; color: var(--text-muted);">
                                <li style="margin-bottom:0.5rem"><strong>Theme Customization:</strong> Fully
                                    customizable color
                                    schemes with Glassmorphism support.</li>
                                <li style="margin-bottom:0.5rem"><strong>My Rosters:</strong> Save "Snapshots" of your
                                    current
                                    work to restore later. Perfect for scenario planning.</li>
                                <li style="margin-bottom:0.5rem"><strong>Branding:</strong> Upload your company logo and
                                    customize the header strapline.</li>
                                <li style="margin-bottom:0.5rem"><strong>Keyboard Shortcuts:</strong> Press <kbd>?</kbd>
                                    to see
                                    available shortcuts.</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- New Shift Modal -->
        <div class="modal-overlay" id="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="shift-modal-title">Add New Shift</h2>
                    <button class="btn btn-outline btn-icon" id="close-modal"><i data-lucide="x"></i></button>
                </div>
                <form id="shift-form">
                    <input type="hidden" id="form-shift-id">
                    <div class="form-group">
                        <label>Employee</label>
                        <select class="form-control" id="form-staff" required></select>
                    </div>
                    <div class="form-group">
                        <label>Day of Week</label>
                        <select class="form-control" id="form-day" required>
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Shift Type (Preset)</label>
                        <select class="form-control" id="form-shift-type">
                            <option value="">Custom / Manual Time</option>
                            <option value="E">Early (8h)</option>
                            <option value="L">Late (8h)</option>
                            <option value="N">Night (8h)</option>
                            <option value="D12">Day (12h)</option>
                            <option value="N12">Night (12h)</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Start Time</label>
                            <input type="time" class="form-control" id="form-start" value="09:00" required>
                        </div>
                        <div class="form-group">
                            <label>End Time</label>
                            <input type="time" class="form-control" id="form-end" value="17:00" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" id="cancel-modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Shift</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New Staff Modal -->
        <div class="modal-overlay" id="staff-modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="staff-modal-title">Add Employee</h2>
                    <button class="btn btn-outline btn-icon" id="close-staff-modal"><i data-lucide="x"></i></button>
                </div>
                <form id="staff-form">
                    <input type="hidden" id="staff-id">
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Staff #</label>
                            <input type="text" class="form-control" id="staff-number" readonly placeholder="001"
                                style="background: rgba(255, 255, 255, 0.05); color: var(--text-muted); cursor: not-allowed;">
                        </div>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" class="form-control" id="staff-name" placeholder="e.g. Alice Thompson"
                                required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <input type="text" class="form-control" id="staff-role" placeholder="e.g. Duty Manager"
                            list="role-list" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Hourly Rate (£)</label>
                            <input type="number" step="0.01" class="form-control" id="staff-rate" value="12.50"
                                required>
                        </div>
                        <div class="form-group">
                            <label>Contracted Hours</label>
                            <input type="number" step="0.5" class="form-control" id="staff-contracted" value="40"
                                required>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" class="form-control" id="staff-dob">
                        </div>
                        <div class="form-group">
                            <label>Contractual Start Date</label>
                            <input type="date" class="form-control" id="staff-start-date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Color Tag</label>
                        <input type="color" class="form-control" id="staff-color" value="#6366f1">
                    </div>
                    <div class="form-group"
                        style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                        <input type="checkbox" id="staff-optout">
                        <label for="staff-optout" style="margin-bottom: 0;">48h Opt-Out signed?</label>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" id="cancel-staff-modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Employee</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Pattern Library Modal -->
        <div class="modal-overlay" id="pattern-library-modal">
            <div class="modal" style="max-width: 900px;">
                <div class="modal-header">
                    <h2>📚 Shift Pattern Library</h2>
                    <button class="btn btn-outline btn-icon" id="close-pattern-library"><i data-lucide="x"></i></button>
                </div>

                <div style="padding: 0 1.5rem;">
                    <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                        Choose from industry-standard shift patterns and apply to your team
                    </p>

                    <!-- Filters -->
                    <div class="pattern-filters"
                        style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                            <select class="form-control" id="pattern-region-filter">
                                <option value="all">All Regions</option>
                                <option value="global">Global</option>
                                <option value="uk">United Kingdom</option>
                                <option value="us">United States</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                            <select class="form-control" id="pattern-industry-filter">
                                <option value="all">All Industries</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="manufacturing">Manufacturing</option>
                                <option value="emergency-services">Emergency Services</option>
                                <option value="police">Police</option>
                                <option value="tech">Technology</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                            <input type="text" class="form-control" id="pattern-search"
                                placeholder="Search patterns...">
                        </div>
                    </div>

                    <!-- Pattern Grid -->
                    <div id="pattern-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; max-height: 400px; overflow-y: auto; padding: 0.5rem;">
                        <!-- Pattern cards will be inserted here -->
                        <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--text-muted);">
                            Loading patterns...
                        </div>
                    </div>
                </div>

                <div class="modal-footer" style="border-top: 1px solid var(--glass-border); padding: 1.5rem;">
                    <button type="button" class="btn btn-outline" id="cancel-pattern-library">Cancel</button>
                    <button type="button" class="btn btn-primary" id="apply-pattern-btn" disabled>
                        <i data-lucide="check"></i> Apply Pattern
                    </button>
                </div>
            </div>
        </div>

        <!-- Pattern Preview Modal -->
        <div class="modal-overlay" id="pattern-preview-modal">
            <div class="modal" style="max-width: 700px;">
                <div class="modal-header">
                    <h2 id="preview-pattern-name">Pattern Preview</h2>
                    <button class="btn btn-outline btn-icon" id="close-pattern-preview"><i data-lucide="x"></i></button>
                </div>

                <div style="padding: 1.5rem;">
                    <!-- Pattern Info -->
                    <div id="preview-pattern-info" style="margin-bottom: 1.5rem;">
                        <!-- Populated dynamically -->
                    </div>

                    <!-- Pattern Visualization -->
                    <div id="preview-pattern-viz" style="margin-bottom: 1.5rem;">
                        <!-- Visual timeline -->
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" class="form-control" id="pattern-start-date" value="">
                        </div>
                        <div class="form-group">
                            <label>Start at Pattern Day</label>
                            <select class="form-control" id="pattern-day-offset">
                                <option value="0">Day 1 (Rotation Start)</option>
                                <option value="1">Day 2</option>
                                <option value="2">Day 3</option>
                                <option value="3">Day 4</option>
                                <option value="4">Day 5</option>
                                <option value="5">Day 6</option>
                                <option value="6">Day 7</option>
                                <option value="7">Day 8</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Number of Weeks</label>
                        <input type="number" class="form-control" id="pattern-weeks" value="4" min="1" max="12">
                    </div>
                    <div class="form-group" style="display: flex; align-items: center; gap: 0.5rem; margin-top: 1rem;">
                        <input type="checkbox" id="pattern-clear-existing" checked>
                        <label for="pattern-clear-existing" style="margin-bottom: 0; cursor: pointer;">
                            <strong>Clear existing shifts</strong> for selected personnel/dates
                        </label>
                    </div>
                </div>

                <div class="modal-footer" style="border-top: 1px solid var(--glass-border);">
                    <button type="button" class="btn btn-outline" id="back-to-library">Back to Library</button>
                    <button type="button" class="btn btn-primary" id="confirm-apply-pattern">
                        <i data-lucide="zap"></i> Generate Shifts
                    </button>
                </div>
            </div>
        </div>

        <!-- AI Roster Import Modal -->
        <div class="modal-overlay" id="ai-import-modal">
            <div class="modal" style="max-width: 800px;">
                <div class="modal-header">
                    <h2>⚡ AI Roster Recognition</h2>
                    <button class="btn btn-outline btn-icon" id="close-ai-import"><i data-lucide="x"></i></button>
                </div>

                <div style="padding: 1.5rem;" id="ai-modal-content">
                    <!-- Step 1: Upload -->
                    <div id="ai-step-upload">
                        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                            Upload your existing roster (Excel, CSV, PDF, or Image) and our AI will detect the shift
                            rotation patterns.
                        </p>
                        <div class="ai-upload-area" id="ai-drop-zone">
                            <i data-lucide="upload-cloud"></i>
                            <h3>Drop roster file here</h3>
                            <p style="color: var(--text-muted); font-size: 0.9rem;">or click to browse</p>
                            <input type="file" id="ai-file-input" hidden accept=".csv,.xlsx,.xls,.pdf,.png,.jpg,.jpeg">
                        </div>
                    </div>

                    <!-- Step 2: Processing -->
                    <div id="ai-step-processing" style="display: none;">
                        <div class="processing-container">
                            <i data-lucide="loader" class="spin"
                                style="width: 48px; height: 48px; color: var(--accent-blue);"></i>
                            <h3>Analyzing Roster...</h3>
                            <p style="color: var(--text-muted);" id="ai-status-text">Detecting shift patterns and
                                mapping
                                staff</p>
                            <div class="progress-bar-container">
                                <div class="progress-bar-fill" id="ai-progress-bar"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Mapping & Results -->
                    <div id="ai-step-results" style="display: none;">
                        <div id="detected-pattern-summary" class="pattern-preview-card" style="margin-bottom: 2rem;">

                            <div
                                style="background: var(--glass-light); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: space-between; border: 1px solid var(--glass-border);">
                                <div>
                                    <label
                                        style="display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.25rem;">Roster
                                        Duration</label>
                                    <select class="form-control" id="ai-duration-mode" style="min-width: 200px;">
                                        <option value="4weeks">4 Weeks (28 Days)</option>
                                        <option value="remainder">Remainder of Current Month</option>
                                        <option value="full_month">Full Month (30/31 Days)</option>
                                        <option value="full_year">Full Year (52 Weeks)</option>
                                    </select>
                                </div>
                                <div style="text-align: right;">
                                    <label
                                        style="display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.25rem;">Coverage</label>
                                    <span style="font-size: 0.9rem; color: var(--accent-blue);"
                                        id="ai-coverage-date-preview">Calculated on import</span>
                                </div>
                            </div>


                            <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">Staff Mapping</h3>
                            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                                We matched these people from your file to your current staff directory.
                            </p>
                            <div class="mapping-grid" id="ai-mapping-grid">
                                <!-- Mapping rows will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer" id="ai-modal-footer" style="display: none;">
                        <button type="button" class="btn btn-outline" id="ai-reset-btn">Start Over</button>
                        <button type="button" class="btn btn-primary" id="ai-apply-btn">
                            <i data-lucide="check"></i> Confirm & Import
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Template Modal -->
        <div class="modal-overlay" id="template-modal">
            <div class="modal" style="max-width: 500px;">
                <div class="modal-header">
                    <h2 id="template-modal-title">Shift Template</h2>
                    <button class="btn btn-outline btn-icon" id="close-template-modal"><i data-lucide="x"></i></button>
                </div>

                <!-- Save Template Form -->
                <form id="template-form" style="padding: 1.5rem;">
                    <div class="form-group">
                        <label>Template Name</label>
                        <input type="text" class="form-control" id="template-name" placeholder="e.g. Standard Day Shift"
                            required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Start Time</label>
                            <input type="time" class="form-control" id="template-start" value="09:00" required>
                        </div>
                        <div class="form-group">
                            <label>End Time</label>
                            <input type="time" class="form-control" id="template-end" value="17:00" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Days to Apply</label>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                            <label style="display:flex;align-items:center;gap:0.25rem;"><input type="checkbox"
                                    class="template-day-checkbox" value="0" checked> Mon</label>
                            <label style="display:flex;align-items:center;gap:0.25rem;"><input type="checkbox"
                                    class="template-day-checkbox" value="1" checked> Tue</label>
                            <label style="display:flex;align-items:center;gap:0.25rem;"><input type="checkbox"
                                    class="template-day-checkbox" value="2" checked> Wed</label>
                            <label style="display:flex;align-items:center;gap:0.25rem;"><input type="checkbox"
                                    class="template-day-checkbox" value="3" checked> Thu</label>
                            <label style="display:flex;align-items:center;gap:0.25rem;"><input type="checkbox"
                                    class="template-day-checkbox" value="4" checked> Fri</label>
                            <label style="display:flex;align-items:center;gap:0.25rem;"><input type="checkbox"
                                    class="template-day-checkbox" value="5"> Sat</label>
                            <label style="display:flex;align-items:center;gap:0.25rem;"><input type="checkbox"
                                    class="template-day-checkbox" value="6"> Sun</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary"><i data-lucide="save"></i> Save Template</button>
                    </div>
                </form>

                <!-- Apply Template Section -->
                <div id="apply-template-section" style="display: none; padding: 1.5rem;">
                    <div class="form-group">
                        <label>Select Template</label>
                        <select class="form-control" id="template-select">
                            <option value="">-- Select Template --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display:flex;justify-content:space-between;align-items:center;">
                            Select Staff
                            <button type="button" class="btn btn-outline" id="select-all-staff"
                                style="padding:0.25rem 0.5rem;font-size:0.75rem;">Select All</button>
                        </label>
                        <div id="staff-checkbox-list"
                            style="max-height: 200px; overflow-y: auto; margin-top: 0.5rem; padding: 0.5rem; background: var(--bg-dark); border-radius: 0.5rem;">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="confirm-apply-template"><i
                                data-lucide="check"></i> Apply to Week</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Help -->
        <div id="shortcuts-help"
            style="display: none; position: fixed; bottom: 1.5rem; right: 1.5rem; background: var(--card-bg); border: 1px solid var(--glass-border); padding: 1rem; border-radius: 0.75rem; box-shadow: 0 8px 32px rgba(0,0,0,0.4); z-index: 1000; font-size: 0.85rem;">
            <h4 style="margin-bottom: 0.5rem; color: var(--accent-blue);">Keyboard Shortcuts</h4>
            <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem;">
                <span><kbd>N</kbd></span> <span>New Shift</span>
                <span><kbd>S</kbd></span> <span>Staff Directory</span>
                <span><kbd>R</kbd></span> <span>Shift Roster</span>
                <span><kbd>C</kbd></span> <span>Compliance</span>
                <span><kbd>T</kbd></span> <span>Toggle Dark Mode</span>
                <span><kbd>← / →</kbd></span> <span>Prev/Next Week</span>
                <span><kbd>?</kbd></span> <span>Show/Hide this help</span>
            </div>
        </div>

        <div class="toast-container" id="toast-container"></div>

        <datalist id="role-list"></datalist>

        <!-- Custom Confirmation Modal (Enhanced) -->
        <div class="modal-overlay" id="confirm-modal-overlay" style="z-index: 3000;">
            <div class="modal" style="max-width: 440px; text-align: center;">
                <div id="confirm-modal-icon" style="margin-bottom: 1.5rem;">
                    <i data-lucide="help-circle" style="width: 48px; height: 48px; color: var(--accent-blue);"></i>
                </div>
                <h2 id="confirm-modal-title" style="margin-bottom: 1rem;">Confirm Action</h2>
                <div id="confirm-modal-body"
                    style="color: var(--text-muted); line-height: 1.6; margin-bottom: 2rem; text-align: left; white-space: pre-wrap; font-size: 0.95rem;">
                    Are you sure you want to proceed?
                </div>

                <div id="confirm-modal-date-container" style="display: none; margin-bottom: 2rem; text-align: left;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.85rem;">Select
                        Date</label>
                    <div id="confirm-modal-date-inner"></div>
                </div>

                <div id="confirm-modal-text-container" style="display: none; margin-bottom: 2rem; text-align: left;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.85rem;">Enter
                        Name</label>
                    <div id="confirm-modal-text-inner"></div>
                </div>

                <div id="confirm-modal-select-container" style="display: none; margin-bottom: 2rem; text-align: left;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.85rem;">Select
                        Option</label>
                    <div id="confirm-modal-select-inner"></div>
                </div>

                <div id="confirm-modal-actions"
                    style="display: none; flex-direction: column; gap: 0.75rem; margin-top: 1rem;">
                    <!-- Custom buttons injected here -->
                </div>

                <div class="modal-footer" id="confirm-modal-footer-standard"
                    style="justify-content: center; gap: 1rem;">
                    <button type="button" class="btn btn-outline" id="confirm-cancel-btn"
                        style="flex: 1;">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirm-proceed-btn"
                        style="flex: 1;">Proceed</button>
                </div>
            </div>
        </div>

        <!-- Personal Monthly Roster Modal -->
        <div class="modal-overlay" id="monthly-roster-modal">
            <div class="modal"
                style="max-width: 900px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                <div class="modal-header">
                    <h2><i data-lucide="calendar-days" style="width: 24px; height: 24px; margin-right: 0.5rem;"></i>
                        Personal Monthly Roster</h2>
                    <button class="btn btn-outline btn-icon" id="close-monthly-roster"><i data-lucide="x"></i></button>
                </div>

                <div style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--glass-border);">
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 200px;">
                            <select class="form-control" id="monthly-staff-select">
                                <option value="">-- Select Staff Member --</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button class="btn btn-outline btn-icon" id="monthly-prev-month"><i
                                    data-lucide="chevron-left" style="width:16px;height:16px;"></i></button>
                            <span id="monthly-current-month"
                                style="font-weight: 600; min-width: 150px; text-align: center;">December 2024</span>
                            <button class="btn btn-outline btn-icon" id="monthly-next-month"><i
                                    data-lucide="chevron-right" style="width:16px;height:16px;"></i></button>
                        </div>
                    </div>
                </div>

                <div style="flex: 1; overflow-y: auto; padding: 1.5rem;">
                    <!-- Calendar Grid -->
                    <div class="monthly-calendar-grid" id="monthly-calendar-grid">
                        <!-- Days will be generated here -->
                    </div>

                    <!-- Stats Summary -->
                    <div id="monthly-stats-summary"
                        style="margin-top: 1.5rem; padding: 1rem; background: var(--glass-light); border-radius: 12px; display: none;">
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; text-align: center;">
                            <div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);"
                                    id="monthly-total-shifts">0</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Shifts</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-emerald);"
                                    id="monthly-total-hours">0h</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Total Hours</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-amber);"
                                    id="monthly-rest-days">0</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Rest Days</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-purple);"
                                    id="monthly-night-shifts">0</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Night Shifts</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer" style="border-top: 1px solid var(--glass-border);">
                    <button type="button" class="btn btn-outline" id="monthly-export-pdf">
                        <i data-lucide="download"></i> Export PDF
                    </button>
                    <button type="button" class="btn btn-primary" id="monthly-close-btn">Close</button>
                </div>
            </div>
        </div>

        <!-- Roster Wizard Modal -->
        <div class="modal-overlay" id="roster-wizard-modal">
            <div class="modal" style="max-width: 900px; height: 80vh; display: flex; flex-direction: column;">
                <div class="modal-header">
                    <div>
                        <h2><i data-lucide="wand-2"
                                style="width:24px; color:var(--accent-purple); margin-right:8px;"></i>
                            Shift Pattern
                            Wizard</h2>
                        <p style="color:var(--text-muted);font-size:0.9rem;">Design compliance-safe rosters in 4 steps
                        </p>
                    </div>
                    <button type="button" class="btn btn-outline btn-icon" id="wizard-close-btn"><i
                            data-lucide="x"></i></button>
                </div>

                <!-- Wizard Steps Header -->
                <div
                    style="padding: 1rem 1.5rem; background: var(--glass-bg); border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between;">
                    <div class="wizard-step-auth active" data-step="1">1. Design</div>
                    <div class="wizard-step-auth" data-step="2">2. Coverage</div>
                    <div class="wizard-step-auth" data-step="3">3. Staffing</div>
                    <div class="wizard-step-auth" data-step="4">4. Confirm</div>
                </div>

                <div class="modal-body" style="flex-grow: 1; overflow-y: auto; padding: 1.5rem;">

                    <!-- Step 1: Designer -->
                    <div class="wizard-panel" data-step="1">
                        <h3>Design Pattern</h3>
                        <p style="margin-bottom: 1rem;">Click standard codes to rotate shift types (E > L > N > R) or
                            drag for custom times.</p>

                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                            <button class="btn btn-sm btn-primary">Cyclic (Infinite)</button>
                            <button class="btn btn-sm btn-outline">Calendar (Fixed Week)</button>
                            <div style="margin-left:auto;">
                                <label>Cycle Length: <input type="number" id="wizard-cycle-input" value="7"
                                        style="width:50px; padding:4px;"></label>
                            </div>
                        </div>

                        <div id="wizard-pattern-grid"
                            style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem;">
                            <!-- Grid injected by JS -->
                        </div>

                        <div style="margin-top: 2rem;">
                            <label>Pattern Sequence (Text):</label>
                            <input type="text" class="form-control" placeholder="e.g. E,E,L,L,N,N,R,R"
                                style="font-family: monospace; letter-spacing: 1px;" id="wizard-pattern-text">
                        </div>
                    </div>

                    <!-- Step 2: Resources -->
                    <div class="wizard-panel" data-step="2" style="display: none;">
                        <h3>Resource Requirements</h3>
                        <p>How many staff members do you need for each shift type in this pattern?</p>
                        <div id="wizard-resource-inputs" style="margin-top: 1.5rem; max-width: 400px;">
                            <!-- Injected by JS -->
                        </div>
                    </div>

                    <!-- Step 3: Staffing -->
                    <div class="wizard-panel" data-step="3" style="display: none;">
                        <h3>Assign Staff</h3>
                        <p>Select staff to apply this pattern to. We'll stagger start dates if needed.</p>
                        <div id="wizard-staff-list">
                            <!-- Staff selection list -->
                            <p style="padding: 2rem; text-align: center; color: var(--text-muted);">Staff selection
                                coming soon...</p>
                        </div>
                    </div>

                    <!-- Step 4: Confirm -->
                    <div class="wizard-panel" data-step="4" style="display: none;">
                        <h3>Ready to Build?</h3>
                        <div id="wizard-summary"></div>
                    </div>

                </div>

                <div class="modal-footer" style="justify-content: space-between;">
                    <button type="button" class="btn btn-outline" id="wizard-prev-btn" disabled>Back</button>
                    <div>
                        <button type="button" class="btn btn-primary" id="wizard-next-btn">Next
                            Step</button>
                        <button type="button" class="btn btn-primary" id="wizard-finish-btn"
                            style="display: none; background: var(--accent-emerald); border-color: var(--accent-emerald);">Generate
                            Roster</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vendor Libraries -->
        <script src="src/vendor/xlsx.min.js"></script>
        <script src="src/vendor/pdf.min.js"></script>
        <script src="src/vendor/tesseract.min.js"></script>
        <script src="src/vendor/jspdf.min.js"></script>
        <script src="src/vendor/jspdf-autotable.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script>
            // PDF.js worker configuration
            // We set this here or in DocumentParser, but setting it global is safer
            window.pdfjsLib = window['pdfjs-dist/build/pdf'];
        </script>

        </main>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav">
        <button class="nav-btn active" data-view="roster">
            <i data-lucide="calendar"></i>
            <span>Roster</span>
        </button>
        <button class="nav-btn" data-view="staff">
            <i data-lucide="users"></i>
            <span>Staff</span>
        </button>
        <button class="nav-btn" data-view="compliance">
            <i data-lucide="shield-check"></i>
            <span>Compliance</span>
        </button>
        <button class="nav-btn" data-view="settings">
            <i data-lucide="settings"></i>
            <span>Settings</span>
        </button>
    </nav>

    <!-- Mobile Floating Action Button -->
    <button class="mobile-fab" id="mobile-add-shift" title="Add Shift">
        <i data-lucide="plus"></i>
    </button>

    <!-- AI Modules -->
    <script src="src/js/core/ErrorBoundary.js"></script>
    <script src="src/js/core/ServiceRegistry.js"></script>
    <script src="src/js/ai/DocumentParser.js"></script>
    <script src="src/js/ai/ShiftDataNormalizer.js"></script>
    <script src="src/js/ai/PatternDetectionEngine.js"></script>
    <script src="src/js/ai/AIPatternUI.js"></script>
    <script src="src/js/compliance/ComplianceEngine.js"></script>
    <script src="src/js/compliance/ComplianceReporter.js"></script>
    <script src="src/js/patterns/ShiftPattern.js"></script>
    <script src="src/js/patterns/PatternEngine.js"></script>
    <script src="src/js/patterns/PatternLibraryUI.js"></script>
    <script src="src/js/templates/ShiftTemplates.js"></script>
    <script src="src/js/allocation/AllocationEngine.js"></script>
    <script src="src/js/views/MonthlyRosterView.js"></script>
    <script src="src/js/roster/RosterLogic.js"></script>
    <script src="src/js/roster/wizard/WizardStep2.js"></script>
    <script src="src/js/roster/RosterWizard.js"></script>
    <script src="src/js/app.js"></script>
</body>

</html>